function LocalDataStorage(e){function n(e){for(var n=[],a=0;a<i.length;a++)i[a].LDS_DELETED===!1&&t(i[a],e)&&n.push(a);return n}function t(e,n){if(void 0===n||null===n||"function"!=typeof n)return!0;var t=n.call(e);return t}function a(e,n){for(var t={},a=0;a<n.length;a++){var l=n[a];"function"!==l.type&&(t[l.name]=e[l.name])}return t}function l(e,n,t,a){var o=t[a];return"ASC"===o.direction.toUpperCase()&&e[o.name]<n[o.name]||"DESC"===o.direction.toUpperCase()&&e[o.name]>n[o.name]?-1:"ASC"===o.direction.toUpperCase()&&e[o.name]>n[o.name]||"DESC"===o.direction.toUpperCase()&&e[o.name]<n[o.name]?1:a+1<t.length?l(e,n,t,a+1):0}function o(e){return"[object Array]"===Object.prototype.toString.call(e)?!0:!1}var r="",u=[],i=[],s=!1,d=0;this.getId=function(){return r},this.getStructure=function(){return u},this.isDebug=function(){return s},this.getRawRows=function(){return i},this.setDebug=function(e){s=e},this.addColumn=function(e){if(s&&console.info("LocalDataStorage.addColumn()"),void 0===e.name||null===e.name)return console.error("Column name can not be null"),null;if("LDS_"===e.name.substring(0,4))return console.error('Columnprefix "LDS_" is reserved for internal functions'),null;for(var n=0;n<u.length;n++){var t=u[n];if(t.name===e.name)return console.error('Column "'+e.name+'" already exists'),null}return void 0===e.type&&(e.type="string"),"string"!==e.type&&"number"!==e.type&&"boolean"!==e.type?(console.error('Column "'+e.name+'" does not support datatype "'+e.type+'"'),null):(void 0!==e.defaultvalue&&null!==e.defaultvalue?"string"===e.type?e.defaultvalue=this.validateValueString(e.defaultvalue):"number"===e.type?e.defaultvalue=this.validateValueNumber(e.defaultvalue):"boolean"===e.type&&(e.defaultvalue=this.validateValueBoolean(e.defaultvalue)):e.defaultvalue=null,void 0!==e.nullable&&null!==e.nullable?e.nullable!==!0&&e.nullable!==!1&&(e.nullable=!0):e.nullable=!0,u.push({name:e.name,type:e.type,defaultvalue:e.defaultvalue,nullable:e.nullable}),s&&console.info('Column "'+e.name+'" with type "'+e.type+'" added successfully'),!0)},this.addRow=function(e){s&&console.info("LocalDataStorage.addRow()");var n={};if(n.LDS_ROWGUID=this.createRowGuid(),n.LDS_ROWVERSION=this.getCurrentRowVersion(!0),n.LDS_DELETED=!1,void 0!==e&&null!==e)for(var t=0;t<u.length;t++){var a=u[t];void 0!==e[a.name]?"string"===a.type?n[a.name]=this.validateValueString(e[a.name]):"number"===a.type?n[a.name]=this.validateValueNumber(e[a.name]):"boolean"===a.type&&(n[a.name]=this.validateValueBoolean(e[a.name])):a.nullable===!1&&null===a.defaultvalue?console.error('Column "'+a.name+'" can not be null'):n[a.name]=a.defaultvalue}return s&&console.info(n),i.push(n),n},this.select=function(e,n,t){return this.selectRow(e,n,t)},this.selectRow=function(e,t,r){var d=[],f=[];r=r||0;for(var c=n(e),v=0;v<c.length;v++)f.push(i[c[v]]);if(void 0!==t&&null!==t){if(!o(t)){var h=[];h.push(t),t=h}s&&console.log(t),f.sort(function(e,n){return l(e,n,t,0)})}for(var m=0;m<f.length;m++)(0===r||r>m)&&d.push(a(f[m],u));return d},this.update=function(e,n){return this.updateRow(e,n)},this.updateRow=function(e,t){if(s&&console.info("LocalDataStorage.updateRow()"),!t)throw new Error("data can not be null");for(var a=n(e),l=0,o=0,r=0;r<a.length;r++){for(var d=!1,f=0;f<u.length;f++){var c=t[u[f].name],v=u[f];void 0!==c&&(null===c?u[f].nullable?(i[a[r]][u[f].name]=null,d=!0):console.error('Column "'+v.name+'" can not be null'):"string"===v.type?(i[a[r]][u[f].name]=this.validateValueString(c),d=!0):"number"===v.type?(i[a[r]][u[f].name]=this.validateValueNumber(c),d=!0):"boolean"===v.type&&(i[a[r]][u[f].name]=this.validateValueBoolean(c),d=!0))}d&&(0===o&&(o=this.getCurrentRowVersion(!0)),i[a[r]].LDS_ROWVERSION=o,l++)}return l},this.deleteRow=function(e){s&&console.info("LocalDataStorage.deleteRow()");for(var t=n(e),a=0,l=0,o=0;o<t.length;o++){var r={};0===l&&(l=this.getCurrentRowVersion(!0)),r.LDS_ROWGUID=i[t[o]].LDS_ROWGUID,r.LDS_ROWVERSION=l,r.LDS_DELETED=!0,i[t[o]]=r,a++}return a},this.validateValueString=function(e){return String(e)},this.validateValueNumber=function(e){var n=parseInt(e);return isNaN(n)&&(n=0),n},this.validateValueBoolean=function(e){return"string"==typeof e?e="true"===e.toLowerCase()?!0:"false"===e.toLowerCase()?!1:null:"number"==typeof e?e=1===e?!0:0===e?!1:null:"object"==typeof e&&(e=null),e},this.getCurrentRowVersion=function(e){return e?++d:d},this.createRowGuid=function f(){function e(e){var n=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+n.substr(0,4)+"-"+n.substr(4,4):n}return e()+e(!0)+e(!0)+e()},this.initiate=function(e){void 0!==e&&null!==e&&(void 0!==e.id&&null!==e.id&&(r=e.id),void 0!==e.debug&&null!==e.debug&&(s=e.debug),void 0!==e.databasechangeversion&&null!==e.databasechangeversion&&(d=e.databasechangeversion)),s&&console.info("LocalDataStorage.initiate()")},this.initiate(e)}
//# sourceMappingURL=./datastorage.min.map